#! /usr/bin/env perl

use Dancer2;
use Dancer2::Plugin::DBIC;

use autodie;

use FindBin;
use lib $FindBin::Bin =~ s{/bin$}{/lib}r;

use aliased 'DBIx::Class::DeploymentHandler' => 'DH';

my ($dbname) = config->{plugins}{DBIC}{default}{dsn} =~ m/dbname=(\w+)/;
system 'createdb', $dbname and die "Couldn't create database $dbname";

my $dh = DH->new({
  schema              => schema,
  databases           => 'PostgreSQL',
  sql_translator_args => { add_drop_table => 0 },
});

$dh->prepare_install();

$dh->install();
