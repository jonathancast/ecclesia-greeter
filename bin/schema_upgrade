#! /usr/bin/env perl

use Dancer2;
use Dancer2::Plugin::DBIC;

use autodie;

use FindBin;
use lib $FindBin::Bin =~ s{/bin$}{/lib}r;

use Getopt::Long;

use aliased 'DBIx::Class::DeploymentHandler' => 'DH';

GetOptions(
    'from=i' => \my $from_version,
    'to=i' => \my $to_version,
)
    or die "Error in command line arguments\n"
;

my $dh = DH->new({
  schema              => schema,
  databases           => 'PostgreSQL',
  sql_translator_args => { add_drop_table => 0 },
});

$dh->prepare_deploy();
$dh->prepare_upgrade({
  from_version => $from_version,
  to_version   => $to_version,
});

$dh->upgrade();
